网站基于 Django3.0.4，用uwsgi+nginx部署。

用了博主[一叶斋](https://xieguanglei.github.io/)的样式表。

开启virtualenv环境，在本地先测试一下： python manage.py runserver 如果成功就可以进行部署。
项目的根文件夹 在 **/var/www/** 下。

首先给nginx创建配置文件

~~~
vim /etc/nginx/conf.d/myblog.conf
~~~

内容如下：

~~~
server {
	listen 443 ssl;
	server_name ljwonder.com;
	access_log /var/log/nginx/access.log;
	error_log /var/log/nginx/error.log;
	charset utf-8;
	ssl on;
	ssl_certificate /var/www/ssl_path/full_chain.pem;
	ssl_certificate_key /var/www/ssl_path/private.key;

	location /{
		include /var/www/myblog/uwsgi_params;
		uwsgi_connect_timeout 30;
		uwsgi_pass unix:/var/www/myblog/script/uwsgi.sock;
		}

	location /static/ {
		alias /var/www/myblog/static/;
		}

	location /media/ {
		alias /var/www/myblog/media/;
		}
	}
server {
    listen 80;
    server_name  ljwonder.com  www.ljwonder.com;
    rewrite ^(.*) https://ljwonder.com$1 permanent;
}
~~~

第8、9行的full_chain.pem和private.key是在[FreeSSl](https://freessl.cn/)用**浏览器**生成的。


然后开启virtualenv环境 source bin/activate
进入srcip目录，执行

~~~
uwsgi --ini uwsgi.ini   # 启动uwsgi配置
~~~

行了。

附带几个nginx uwsgi常用命令

~~~
~/myblog/script$ sudo /etc/init.d/nginx start   # 启动nginx
~/myblog/script$ sudo /etc/init.d/nginx stop    # 停止nginx
~/myblog/script$ sudo /etc/init.d/nginx restart # 重启nginx
~/myblog/script$ sudo /etc/init.d/nginx reload  # 重新载入nginx配置,影响比较小，适合运行中的服务。
~/myblog/script$ sudo killall nginx

$ uwsgi --ini uwsgi.ini   # 启动uwsgi配置
$ uwsgi --stop uwsgi.pid  # 关闭uwsgi
$ uwsgi --reload uwsgi.pid  #重新加载配置

$ ps -ef | grep uwsgi
~~~

---
---
后台上传原始markdown格式的稿件之前，可以用浏览器打开*渲染预览.html* **预览网页显示效果。**

收到一个安全警告[GHSA-2m34-jcjv-45xf](https://github.com/advisories/GHSA-2m34-jcjv-45xf)，好家伙2020年6月6日发布的，过了大半年才收到邮件提示  
>An issue was discovered in Django 2.2 before 2.2.13 and 3.0 before 3.0.7. Query parameters generated by the Django admin ForeignKeyRawIdWidget were not properly URL encoded, leading to a possibility of an XSS attack.

按照Django的官方[文档](https://docs.djangoproject.com/zh-hans/3.1/howto/upgrade-version/)，升级版本  
```python
$ python -m pip install -U Django
```
